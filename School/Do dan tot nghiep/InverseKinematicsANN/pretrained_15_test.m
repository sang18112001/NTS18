function [Y,Xf,Af] = pretrained_15_test(X,~,~)
%PRETRAINED_15_TEST neural network simulation function.
%
% Auto-generated by MATLAB, 11-Dec-2023 09:12:44.
% 
% [Y] = pretrained_15_test(X,~,~) takes these arguments:
% 
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = 3xQ matrix, input #1 at timestep ts.
% 
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = 3xQ matrix, output #1 at timestep ts.
% 
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [0.050015307656058;0;-0.00286161180087569];
x1_step1.gain = [9.52646325174905;13.3344725140591;7.91013723419455];
x1_step1.ymin = -1;

% Layer 1
b1 = [-5.297854409020692934;-4.8888247512216524981;6.351381489889945442;-5.208495207779650471;4.6762820731391157025;-4.2416564880457707787;-4.3882613465504265449;-4.2380863842467704217;3.5000686266654286172;3.156374153006229033;3.3048964119397021832;-3.1502741138480785388;-3.0416879521258537444;-2.7715837388499666716;-1.9736509972974636273;2.4201768330311153044;1.9226558625350078646;1.7605565516404813042;-1.5805617809612630964;1.2979904799679311544;0.8779377590915248275;-0.040523069683714399436;-0.054688004740669246551;-0.096417333425096965471;-0.24702601860631567821;0.029516042100008334226;-0.78148653169874526814;0.71679760832410777116;1.3049791773409351592;-0.98380515850757332963;1.1887510017196103451;0.46417333714152814172;-1.7942467036261158242;2.2265126524060421254;-1.3084353126330456885;1.9063376319765370503;-1.767760362036733035;-2.4602335853189019055;2.8460926938653736684;2.7784300982029175309;2.9658983140314978399;3.2389177491888343496;3.5402062918273924375;4.3894681979226097823;-4.0155775776281670275;-4.4681247598496325324;4.4954461719319276369;4.8732787320080639404;-4.6072860837616858021;4.9662435101570752138];
IW1_1 = [3.9337123665854187848 2.994209308639217415 1.0084781482125542151;1.5864103682718653232 -2.2219106088352345019 -3.5008138517520439592;-6.53926638863712828 -1.5067535060495065302 -0.429333735509197012;3.3677966671546362143 3.440182542915108943 0.18125096062181078604;-0.82004726188254262187 -4.2188931586882780778 -2.2574626200155956113;0.84033302387241004539 1.1903682946462612602 -4.2579335857965174839;1.0382275006718493238 -4.9311582723907063652 -1.5789561024368585773;2.9822166588173746327 0.081333732514000584013 -3.1307626232557437262;-4.0115042929160260599 0.55286731082388251846 -0.9640457415660109719;-2.3084286617111904327 -3.6930168030208028185 -2.6049510769591996961;-0.73098847637811881217 3.4545010186286106979 -0.87909978689627876758;3.7715089536914243595 2.6232332385166232669 -1.4510663833928041377;0.61577089573124921262 3.6164133505273587943 3.6143901119807093636;2.2899902644725385059 3.7649341727475684749 -1.8196973993339149445;0.49586310518092530097 -1.7664422924885507804 0.98367079678376023733;-4.0846720738179742582 -2.4019405501759600874 -1.7305634425238622942;-2.9464527907380646532 -2.4562289714517562267 3.2672179373578478234;-2.6167035168171071113 2.8155663061847309159 2.3304928833796014764;2.1324264743759187013 2.8677366019336196779 -3.2367875709094482417;-2.8472062252100887036 -3.7892303992330402806 1.800082799055419347;-1.4660012606649750477 2.1200005431824324731 -3.335124036826449867;3.0045712719200641239 -4.8536297475044776206 2.3781232216215584252;1.1120635573601587165 1.9387510151342597364 1.92977931045480533;3.8494796998519462683 -1.5263769676394898234 -2.0344320211523374553;2.9222031110520778618 -4.2652657576799173356 1.6290274327651812492;2.1028899567489527378 3.5676493413127956522 1.0084552511188042967;-2.2153330828358943627 -1.7084920194541952654 -1.8292522828733448481;0.58605549085559793809 -4.2403771342918803455 2.9622698491711885183;2.6505051785319775348 -1.5649404868598641993 -2.0431916675533825511;-1.9276713774053566564 -1.1184822646268364199 2.7248119892759250504;-0.21122445043835855194 2.3069613390402965436 -2.5077124762200040387;3.3845038863277752128 1.7206683051696083364 0.54904137945593634029;-2.0706723789126399993 3.297422332259148714 -1.3393314976503876146;0.52176165720312306373 4.0340082849656573316 -2.184177914115103647;-3.6673707724562647492 2.953785801532033517 0.98360460878071098723;2.6610639815029104582 -2.1555464245493602959 -2.1729120859957906653;-0.61697613639172832478 4.2716558057608260413 -3.4507929235682270885;-1.9616631577320238211 -1.0051853864947526418 -4.0734393565822433203;2.574545597880860015 -1.9832665618948914776 -0.8297656682559135799;1.6978155232690970156 1.4337104719478310777 3.6905598918535313935;2.6772948141646812914 -3.0645031102990989424 0.54752740681017242341;1.898057759643945408 -3.2412256043673401962 2.7998202177293465276;1.3821991689581760721 -2.5852953641279539099 4.3710540360097995816;0.064445163573991423589 -3.9576200622771215976 -3.069573398881578985;-3.1732385429812342004 2.4539358033331573061 -3.2666905685699294537;-0.37941684819728133116 -4.7235746677962673346 2.2056683634244151904;0.32760765268501940151 4.7214182305866243539 -2.2209031186795336055;2.7741181437123523246 -2.143395505382971411 3.3882298975313087652;-2.2140206017851493669 2.5219314208923728771 -2.7092009856112273525;-0.16122825032248419563 2.1015374554266825768 3.8400024688536440465];

% Layer 2
b2 = [-0.18254613479400447207;-0.47637786413276378417;0.095194392742881467351];
LW2_1 = [0.59994076096765425188 0.0053970121682300207025 0.069114568513762159041 -0.53598749119855515488 -0.4869239677234545316 -0.41090017375439286118 0.01961376518048730741 0.082635319389997380357 0.0064770312342431347191 0.720216982580248688 0.05896592061681751179 -0.020741959556208333648 -0.25113639535521520285 0.11551174854238577261 0.066975441778230504486 -0.024300830659422567592 0.068923995089497494537 0.0036813094080125172321 -0.011728798662859495072 -0.063912569933317772697 0.10636407269903751238 -0.01710045945874368381 0.012013116408092005399 0.0010065452133791333387 -0.012752935899875781495 -0.086574584335057824802 0.0091454684116403506255 0.034991740014964342609 0.0010329852883886841801 0.0050808398706790195223 -0.055937321523655603173 0.0012626386817484595067 -0.18101279831645053497 0.032988556492435032463 -0.011809378255561686979 0.0067333926558745997928 0.41176369256334199864 0.021634204196814912219 -0.27078870367783020034 0.10465491471898338838 0.46707072527294540842 -0.33169832961529793769 -0.17141958260564998939 -0.2666541378197315737 -0.0089195594007296409578 -0.34503552904449585892 -0.33144864015690989056 0.13599685861861182667 0.9510573664134704952 0.0018535943427836203568;0.4384821376654188807 -0.053829097815775182878 0.89497165890381746856 0.44563084866818458707 -0.25422946322083728177 -0.079271003447215840354 -0.42211176979364950501 -0.081902232085567572284 0.064357008824603559316 -0.67446546246455352236 0.51857572884350755515 -0.028234056327747555221 0.5028133027979685421 -0.021980683716857411097 0.078847402657853407626 0.27154914116198458629 -0.051173450685631574619 -0.095708875396281270498 -0.0060544027577800214185 0.021145839464468366153 0.22633036297525011005 1.1990808603321021497 -0.14914971516178679445 -0.021034796482040252902 -0.63337088419578246867 0.0070761240105265063582 0.037097361795629009429 0.045859757288245900364 -0.051526494870756466005 -0.062285125647335397303 -0.43379902290200611503 -0.014195170237236728536 0.36660193056104262155 0.41066717204396280261 0.046809581925720725182 -0.01486031286263892956 -0.23453305634059987139 -0.023304488462958111022 0.052945817549437078353 0.10792152057374347629 0.066676161261925923074 0.30373018575983135037 0.10859302310687393711 0.50169295371288957774 0.067265107846325847274 -0.12983393620702571303 -0.34180182023051441931 0.10024801827198225046 0.10652978895274189952 0.24985685062062160111;-0.55508392023450614516 -0.074190031022691213525 -1.6587852745517206454 -0.86554903240440961287 -0.60514021530418560246 0.44447117005683728364 0.10276676817081771553 0.078074385611107646743 -0.088076957061727162435 -0.69807885718396600616 -0.3599589622048681159 0.037891508154977014688 -1.1802015706884698698 -0.43042438213194900154 0.3274985749219819775 -0.36308995783465286555 0.1126192375716729005 -0.0090622889131053239314 0.087813242967271498696 -0.0047788144704919441677 -0.16471442616217155108 -0.3632021787476563679 0.29482967676687044101 -0.0060643525822541184678 0.23848022192524273577 0.49917223051952991364 -0.043764349525202167479 1.1673670698568638926 -0.012706155560078383204 -0.010031586195430597375 -0.17084121368786783779 0.021936934862374007221 -0.24710203277902220709 1.0417694048610535162 0.019619065445696672045 -0.051243943231612645861 0.67142975633166779303 -0.092055458860314659519 0.089193018251141509278 -0.23913643959766192615 -0.19649997233714353029 -0.18978915171899901626 0.21934542214455135523 1.1314003504053951055 0.028257770711275369963 -1.0847761897075798299 -0.94709629493718827664 0.071428171086037717252 -0.29858794881096889506 0.25494462614207691331];

% Output 1
y1_step1.ymin = -1;
y1_step1.gain = [1.74403571741344;0.844430415084228;0.800698620563121];
y1_step1.xoffset = [0;-0.0867378970815097;-2.74702687782755];

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
  X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
  Q = size(X{1},2); % samples/series
else
  Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS

    % Input 1
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = repmat(b2,1,Q) + LW2_1*a1;
    
    % Output 1
    Y{1,ts} = mapminmax_reverse(a2,y1_step1);
end

% Final Delay States
Xf = cell(1,0);
Af = cell(2,0);

% Format Output Arguments
if ~isCellX
  Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
  y = bsxfun(@minus,x,settings.xoffset);
  y = bsxfun(@times,y,settings.gain);
  y = bsxfun(@plus,y,settings.ymin);
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
  a = 2 ./ (1 + exp(-2*n)) - 1;
end

% Map Minimum and Maximum Output Reverse-Processing Function
function x = mapminmax_reverse(y,settings)
  x = bsxfun(@minus,y,settings.ymin);
  x = bsxfun(@rdivide,x,settings.gain);
  x = bsxfun(@plus,x,settings.xoffset);
end
